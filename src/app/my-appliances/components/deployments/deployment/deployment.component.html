<td><img src="{{ deployment.app_version_details?.application?.icon_url }}"  style="max-width: 64px; max-height: 64px;" /></td>
<td>
    <p><strong>{{ deployment.name }}</strong></p>
    <p>
    <span class="col-xs-12 col-md-6">
        <span class="text-muted">Appliance:</span> {{ deployment.app_version_details?.application?.name }}
    </span>
    <span class="col-xs-12 col-md-6">
        <span class="text-muted">Version:</span> {{ deployment.app_version_details?.version }}
    </span><br />
    <span class="col-xs-12 col-md-12">
        <span class="text-muted">Cloud:</span> {{ deployment.target_cloud }}
    </span>
    <span class="col-xs-12 col-md-12" *ngIf="credentials">
        <span class="text-muted">Credentials:</span> {{ credentials.name }}
    </span>
    </p>
    <div *ngIf=deployment.latest_task?.result?.cloudLaunch?.keyPair?.material>
        <p class="text-info" style="padding-top: 25px;">
            A new SSH key pair was created when this instance
            was launched. The key will be available for
            retrieval only here for up to one hour after the
            instance was launched. <a #kpLink
            target="_blank" download="kp.txt"
            (click)="getKP(deployment)"> Download the key</a> and
            keep it secure.
        </p>
    </div>
</td>
<td class="text-left">
    <div *ngIf="credentials">
        <div [ngSwitch]="deployment.latest_task?.action">
            <div *ngSwitchCase="'LAUNCH'">
                <div [ngSwitch]="deployment.latest_task?.status">
                  <p *ngSwitchCase="'SUCCESS'" class="text-success"><i class="fa fa-bolt fa-fw"></i> RUNNING</p>
                  <p *ngSwitchCase="'FAILURE'" class="text-danger">FAILURE
                     <br />{{ deployment.latest_task?.result?.exc_message }}
                  </p>
                  <p *ngSwitchCase="'UNKNOWN'" class="text-warning">FAILURE
                     <br />{{ deployment.latest_task?.result?.exc_message }}
                  </p>
                  <p *ngSwitchCase="'PENDING'" class="text-info">PENDING</p>
                  <p *ngSwitchCase="'PROGRESSING'" class="text-info"><i class="fa fa-cog fa-spin fa-fw"></i> PROGRESSING
                    <br />{{ deployment.latest_task?.result?.action }}
                  </p>
                </div>
            </div>
            <div *ngSwitchCase="'HEALTH_CHECK'">
                <div [ngSwitch]="deployment.latest_task?.status">
                  <p *ngSwitchCase="'SUCCESS'">
                    <span [ngSwitch]="getInstanceStatus(deployment)">
                      <!-- TODO: add more cases -->
                      <span *ngSwitchCase="'terminated'" class="text-danger">
                        <i class="fa fa-stop fa-fw"></i> TERMINATED
                      </span>
                      <span *ngSwitchDefault class="text-info">
                        UNKNOWN: {{ getInstanceStatus(deployment) }}
                      </span>
                    </span>
                  </p>
                  <p *ngSwitchCase="'FAILURE'" class="text-danger">UNABLE TO CHECK STATUS
                     <br />{{ deployment.latest_task?.result?.exc_message }}
                  </p>
                  <p *ngSwitchCase="'UNKNOWN'" class="text-warning">UNABLE TO CHECK STATUS
                     <br />{{ deployment.latest_task?.result?.exc_message }}
                  </p>
                  <p *ngSwitchCase="'PENDING'" class="text-info">PENDING</p>
                  <p *ngSwitchCase="'PROGRESSING'" class="text-info"><i class="fa fa-cog fa-spin fa-fw"></i> PROGRESSING
                    <br />{{ deployment.latest_task?.result?.action }}
                  </p>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="!credentials">
        <div [ngSwitch]="deployment.latest_task?.status">
          <p *ngSwitchCase="'SUCCESS'" class="text-success"><i class="fa fa-question-circle fa-fw" title="Application was launched successfully but current status is unknown since CloudLaunch does not have saved credentials for {{deployment.target_cloud}}"></i> <em>LAUNCHED</em></p>
          <p *ngSwitchCase="'FAILURE'" class="text-danger">FAILURE
             <br />{{ deployment.latest_task?.result?.exc_message }}
          </p>
          <p *ngSwitchCase="'UNKNOWN'" class="text-warning">FAILURE
             <br />{{ deployment.latest_task?.result?.exc_message }}
          </p>
          <p *ngSwitchCase="'PENDING'" class="text-info">PENDING</p>
          <p *ngSwitchCase="'PROGRESSING'" class="text-info"><i class="fa fa-cog fa-spin fa-fw"></i> PROGRESSING
            <br />{{ deployment.latest_task?.result?.action }}
          </p>
        </div>
    </div>
</td>
<td>{{ calculateUptime(deployment, currentTimer | async) }} ago</td>
<td *ngIf="deployment.latest_task?.result?.cloudLaunch?.applicationURL">
    <a class="btn-link" href="{{ deployment.latest_task?.result?.cloudLaunch?.applicationURL }}" target="_blank">
        <span #inputTarget>{{ deployment.latest_task?.result?.cloudLaunch?.applicationURL }}</span>
    </a>
    <br/><button *ngIf=deployment.latest_task?.result?.cloudLaunch?.publicIP class="btn btn-sm" type="button" [ngxClipboard]="inputTarget">Copy URL</button>
</td>
<td *ngIf="!deployment.latest_task?.result?.cloudLaunch?.applicationURL">
    <a class="btn-link" href="{{ deployment.latest_task?.result?.cloudLaunch?.publicIP }}" target="_blank">
        <span #inputTarget>{{ deployment.latest_task?.result?.cloudLaunch?.publicIP }}</span>
    </a>
    <br/><button *ngIf=deployment.latest_task?.result?.cloudLaunch?.publicIP class="btn btn-sm" type="button" [ngxClipboard]="inputTarget">Copy URL</button>
</td>
<td>
    <!-- TODO: set a flag in the UI component to disable this button as soon as it is clicked, but we'll wait until the refactor into a separate component -->
    <button class="btn btn-info" type="button" (click)="runHealthCheckTask(deployment)" [disabled]="isLatestTaskRunning(deployment)">
        <i class="fa fa-refresh"></i> Refresh Status
    </button>
</td>
